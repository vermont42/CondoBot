# Minimal Path to Deployed Server URL

## Context

CondoBot needs a publicly accessible URL to receive Hospitable webhooks. The project is greenfield — no `package.json`, no `src/`, and Bun is not yet installed. This plan implements the "Minimal Path to Deployed Server URL" section from the EDD: install Bun, create a minimal Hono webhook server, deploy to Railway, and configure the Hospitable webhook.

## Steps

### 1. Install Bun

```bash
curl -fsSL https://bun.sh/install | bash
```

Source the shell profile and verify with `bun --version`.

### 2. Initialize the project

- Run `bun init` from the project root (creates `package.json`, `tsconfig.json`, and a root `index.ts`)
- Delete the root `index.ts` (we'll use `src/index.ts` per the EDD)
- Verify `bun init` didn't overwrite `README.md` — restore from git if it did
- Edit `package.json` to add scripts:
  ```json
  "scripts": {
    "start": "bun run src/index.ts",
    "dev": "bun run --watch src/index.ts"
  }
  ```
- Install Hono: `bun add hono`

### 3. Create two source files (~25 lines total)

**`src/index.ts`** — Entry point. Hono app with:
- `GET /` health check returning `"CondoBot is running"`
- `POST /webhooks/hospitable` routed to the webhook handler
- Binds to `process.env.PORT` (Railway-injected) with fallback to `3000`
- Uses Bun's idiomatic `export default { port, fetch: app.fetch }` pattern

**`src/webhook-handler.ts`** — Logs the incoming JSON payload and returns `{ status: "received" }` with a 200. Try/catch around `c.req.json()` returns 400 on malformed input.

### 4. Verify locally

```bash
bun run dev
# In another terminal:
curl http://localhost:3000/
curl -X POST http://localhost:3000/webhooks/hospitable \
  -H "Content-Type: application/json" \
  -d '{"event":"message.created","data":{"message":"test"}}'
```

### 5. Deploy to Railway

1. Go to https://railway.com, create account / log in
2. **New Project > Deploy from GitHub Repo** — select `vermont42/CondoBot`
3. Railway auto-detects Bun via `bun.lock` and runs `bun install` + `bun run start`
4. In the service's **Variables** tab, add `HOSPITABLE_API_TOKEN` and `SLACK_BOT_TOKEN` (copied from local `.env`) — not needed yet but ready for next phase
5. Commit and push the new files to trigger the deploy:
   - `package.json`, `bun.lock`, `tsconfig.json`, `src/index.ts`, `src/webhook-handler.ts`
6. Verify with `curl` against the Railway URL (e.g. `https://condobot-production.up.railway.app/`)

### 6. Configure Hospitable webhook

1. Log into https://app.hospitable.com
2. **Apps > Webhooks > +Add new**
3. URL: `https://<railway-url>/webhooks/hospitable`
4. Events: select **Messages**
5. Save

### 7. End-to-end verification

Watch Railway logs for the first real webhook payload from a guest message. The payload structure will inform the next development steps (conversation retrieval, SQLite schema validation, etc.).

## Files created/modified

| File | Action |
|------|--------|
| `package.json` | Created by `bun init`, then edited (add scripts, hono dep) |
| `tsconfig.json` | Created by `bun init` (keep defaults) |
| `bun.lock` | Generated by `bun add hono` (committed) |
| `src/index.ts` | **Created** — Hono app entry point |
| `src/webhook-handler.ts` | **Created** — webhook log-and-ack handler |
| Root `index.ts` | **Deleted** — generated by `bun init`, not needed |

## Verification

- `curl GET /` returns `"CondoBot is running"` both locally and on Railway
- `curl POST /webhooks/hospitable` with JSON returns `{"status":"received"}` and logs the payload
- `curl POST /webhooks/hospitable` with malformed body returns 400
- Railway logs show `CondoBot listening on port <PORT>` after deploy
- Hospitable webhook configuration saves successfully
